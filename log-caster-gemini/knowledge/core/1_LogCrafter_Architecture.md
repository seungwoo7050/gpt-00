# LogCaster ì „ì²´ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ

## ğŸ¯ ê°œìš”

LogCasterëŠ” ê³ ì„±ëŠ¥ ë¡œê·¸ ìˆ˜ì§‘ ì‹œìŠ¤í…œìœ¼ë¡œ, TCP ì„œë²„, ì¿¼ë¦¬ ì¸í„°í˜ì´ìŠ¤, IRC í†µí•©ì„ ì œê³µí•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Log Clients   â”‚â”€â”€â”€â”€â–¶â”‚  LogServer   â”‚â”€â”€â”€â”€â–¶â”‚  LogBuffer  â”‚
â”‚   (Port 9999)   â”‚     â”‚              â”‚     â”‚ (In-Memory) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â–¼
â”‚ Query Clients   â”‚â”€â”€â”€â”€â–¶â”‚QueryHandler  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   (Port 9998)   â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IRC Clients    â”‚â”€â”€â”€â”€â–¶â”‚  IRCServer   â”‚â”€â”€â”€â”€â–¶â”‚IRC Channels â”‚
â”‚   (Port 6667)   â”‚     â”‚              â”‚     â”‚ (#logs-*)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. LogServer (ë©”ì¸ ì„œë²„)
```cpp
// [SEQUENCE: 35] RAII ê¸°ë°˜ ì„œë²„ í´ë˜ìŠ¤
class LogServer {
    int listenFd_;           // ë¡œê·¸ ìˆ˜ì§‘ í¬íŠ¸
    int queryFd_;            // ì¿¼ë¦¬ í¬íŠ¸
    ThreadPool* threadPool_; // ì—°ê²° ì²˜ë¦¬ìš©
    LogBuffer* logBuffer_;   // ì¤‘ì•™ ì €ì¥ì†Œ
};
```

**ì—­í• :**
- í¬íŠ¸ 9999ì—ì„œ ë¡œê·¸ ìˆ˜ì‹ 
- í¬íŠ¸ 9998ì—ì„œ ì¿¼ë¦¬ ì²˜ë¦¬
- ë©€í‹°ìŠ¤ë ˆë“œ ì—°ê²° ê´€ë¦¬

### 2. LogBuffer (ì¤‘ì•™ ì €ì¥ì†Œ)
```cpp
// [SEQUENCE: 172] ìŠ¤ë ˆë“œ ì•ˆì „ ìˆœí™˜ ë²„í¼
class LogBuffer {
    std::deque<LogEntry> buffer_;
    std::shared_mutex mutex_;      // ì½ê¸°/ì“°ê¸° ë½
    size_t capacity_;              // ìµœëŒ€ í¬ê¸°
    
    // [SEQUENCE: 692] IRC í†µí•©
    std::map<std::string, callbacks> channelCallbacks_;
};
```

**íŠ¹ì§•:**
- Lock-free í†µê³„
- Observer íŒ¨í„´ìœ¼ë¡œ IRC ì•Œë¦¼
- íš¨ìœ¨ì ì¸ ë©”ëª¨ë¦¬ ê´€ë¦¬

### 3. ThreadPool (ë™ì‹œì„± ì²˜ë¦¬)
```cpp
// [SEQUENCE: 120] í˜„ëŒ€ì  C++ ìŠ¤ë ˆë“œ í’€
class ThreadPool {
    std::vector<std::thread> workers_;
    std::queue<std::function<void()>> tasks_;
    std::condition_variable cv_;
};
```

**ìµœì í™”:**
- ê³ ì • í¬ê¸° ì›Œì»¤ ìŠ¤ë ˆë“œ
- Lock-free í (ê°€ëŠ¥í•œ ê²½ìš°)
- íš¨ìœ¨ì ì¸ íƒœìŠ¤í¬ ë¶„ë°°

### 4. IRCServer (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§)
```cpp
// [SEQUENCE: 500] IRC í”„ë¡œí† ì½œ ì„œë²„
class IRCServer {
    IRCChannelManager* channelManager_;
    IRCClientManager* clientManager_;
    IRCCommandHandler* commandHandler_;
};
```

**í˜ì‹ ì  ê¸°ëŠ¥:**
- ë¡œê·¸ ë ˆë²¨ë³„ ìë™ ì±„ë„
- ì‹¤ì‹œê°„ í•„í„°ë§
- ëŒ€í™”í˜• ì¿¼ë¦¬

## ğŸ”„ ë°ì´í„° íë¦„

### 1. ë¡œê·¸ ìˆ˜ì§‘ íë¦„
```
Client â†’ TCP Socket â†’ LogServer â†’ ThreadPool â†’ LogBuffer
                                                    â†“
                                              IRC Notification
```

### 2. ì¿¼ë¦¬ ì²˜ë¦¬ íë¦„
```
Query Client â†’ QueryHandler â†’ QueryParser â†’ LogBuffer
                                              â†“
                                          Response
```

### 3. IRC ìŠ¤íŠ¸ë¦¬ë° íë¦„
```
LogBuffer â†’ Callback â†’ IRCChannel â†’ Broadcast â†’ IRC Clients
```

## ğŸ”§ ì„¤ê³„ ê²°ì •

### 1. ì™œ 3ê°œì˜ í¬íŠ¸?
- **9999**: ë¡œê·¸ ìˆ˜ì§‘ ì „ìš© (ë†’ì€ ì²˜ë¦¬ëŸ‰)
- **9998**: ì¿¼ë¦¬ ì „ìš© (ë³µì¡í•œ ì²˜ë¦¬)
- **6667**: IRC í‘œì¤€ í¬íŠ¸ (í˜¸í™˜ì„±)

### 2. ì™œ shared_mutex?
```cpp
// ë‹¤ì¤‘ ì½ê¸°, ë‹¨ì¼ ì“°ê¸°
std::shared_lock<std::shared_mutex> lock(mutex_); // ì½ê¸°
std::unique_lock<std::shared_mutex> lock(mutex_); // ì“°ê¸°
```

### 3. ì™œ deque?
- O(1) push/pop
- ì—°ì† ë©”ëª¨ë¦¬ ë¸”ë¡
- ìˆœí™˜ ë²„í¼ êµ¬í˜„ ìš©ì´

## ğŸ“Š ì„±ëŠ¥ íŠ¹ì„±

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
```
LogEntry í¬ê¸°: ~100 bytes
10,000 ì—”íŠ¸ë¦¬: ~1 MB
1,000,000 ì—”íŠ¸ë¦¬: ~100 MB
```

### ì²˜ë¦¬ ì„±ëŠ¥
- ë¡œê·¸ ìˆ˜ì‹ : 10,000+ logs/sec
- ì¿¼ë¦¬ ì‘ë‹µ: < 1ms
- IRC ë¸Œë¡œë“œìºìŠ¤íŠ¸: < 10ms

### ë™ì‹œì„±
- ìµœëŒ€ ì—°ê²°: 1,000+
- ìŠ¤ë ˆë“œ í’€: 8-16 ìŠ¤ë ˆë“œ
- Lock contention: < 5%

## ğŸš€ í™•ì¥ í¬ì¸íŠ¸

### 1. í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ
```cpp
class LogProcessor {
    virtual void process(LogEntry& entry) = 0;
};
```

### 2. ì €ì¥ì†Œ ì¶”ìƒí™”
```cpp
class StorageBackend {
    virtual void store(const LogEntry& entry) = 0;
    virtual std::vector<LogEntry> query(...) = 0;
};
```

### 3. í”„ë¡œí† ì½œ í™•ì¥
- WebSocket ì§€ì›
- gRPC ì¸í„°í˜ì´ìŠ¤
- REST API

## ğŸ’¡ í•µì‹¬ í†µì°°

1. **ë‹¨ìˆœí•¨ì´ ì„±ëŠ¥ì´ë‹¤**: ë³µì¡í•œ íŒŒì‹± ì—†ì´ ë¼ì¸ ê¸°ë°˜ í”„ë¡œí† ì½œ
2. **ë¶„ë¦¬ê°€ í™•ì¥ì„±ì´ë‹¤**: ê° í¬íŠ¸ê°€ ë…ë¦½ì  ì—­í• 
3. **ê´€ì°°ì´ í†µí•©ì´ë‹¤**: Observer íŒ¨í„´ìœ¼ë¡œ ëŠìŠ¨í•œ ê²°í•©

---

ë‹¤ìŒ: [2_TCP_Server_Implementation.md](2_TCP_Server_Implementation.md) - TCP ì„œë²„ êµ¬í˜„ ìƒì„¸